<template>
  <div  class="body">
    <main>
      <nav role="navigation">
        <ul>
          <li tabindex="1">
            <router-link
              to="/"
              class="bg-[#6C5FF3] inline-block p-2 rounded-md"
              href=""
            >
              <svg
                width="26"
                height="26"
                viewBox="0 0 26 26"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M23.8333 11.8084V4.44175C23.8333 2.81675 23.14 2.16675 21.4175 2.16675H17.0408C15.3183 2.16675 14.625 2.81675 14.625 4.44175V11.8084C14.625 13.4334 15.3183 14.0834 17.0408 14.0834H21.4175C23.14 14.0834 23.8333 13.4334 23.8333 11.8084Z"
                  stroke="white"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M23.8333 21.5583V19.6083C23.8333 17.9833 23.14 17.3333 21.4175 17.3333H17.0408C15.3183 17.3333 14.625 17.9833 14.625 19.6083V21.5583C14.625 23.1833 15.3183 23.8333 17.0408 23.8333H21.4175C23.14 23.8333 23.8333 23.1833 23.8333 21.5583Z"
                  stroke="white"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M11.375 14.1917V21.5584C11.375 23.1834 10.6816 23.8334 8.95913 23.8334H4.58246C2.85996 23.8334 2.16663 23.1834 2.16663 21.5584V14.1917C2.16663 12.5667 2.85996 11.9167 4.58246 11.9167H8.95913C10.6816 11.9167 11.375 12.5667 11.375 14.1917Z"
                  stroke="white"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M11.375 4.44175V6.39175C11.375 8.01675 10.6816 8.66675 8.95913 8.66675H4.58246C2.85996 8.66675 2.16663 8.01675 2.16663 6.39175V4.44175C2.16663 2.81675 2.85996 2.16675 4.58246 2.16675H8.95913C10.6816 2.16675 11.375 2.81675 11.375 4.44175Z"
                  stroke="white"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </router-link>
          </li>
          <li tabindex="2">
            <router-link to="/about">
              <svg
                width="26"
                height="26"
                viewBox="0 0 26 26"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M8.66669 2.16663V5.41663"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M17.3333 2.16663V5.41663"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M3.79169 9.84741H22.2084"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M22.75 9.20829V18.4166C22.75 21.6666 21.125 23.8333 17.3333 23.8333H8.66667C4.875 23.8333 3.25 21.6666 3.25 18.4166V9.20829C3.25 5.95829 4.875 3.79163 8.66667 3.79163H17.3333C21.125 3.79163 22.75 5.95829 22.75 9.20829Z"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M17.0026 14.8416H17.0123"
                  stroke="#63698B"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M17.0026 18.0916H17.0123"
                  stroke="#63698B"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M12.9951 14.8416H13.0049"
                  stroke="#63698B"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M12.9951 18.0916H13.0049"
                  stroke="#63698B"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M8.98548 14.8416H8.99521"
                  stroke="#63698B"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M8.98548 18.0916H8.99521"
                  stroke="#63698B"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </router-link>
          </li>
          <li tabindex="3">
            <router-link to="/">
              <svg
                width="26"
                height="26"
                viewBox="0 0 26 26"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M3.25 23.8335H22.75"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M6.06664 9.07812H4.33333C3.7375 9.07812 3.25 9.56563 3.25 10.1615V19.4998C3.25 20.0956 3.7375 20.5831 4.33333 20.5831H6.06664C6.66247 20.5831 7.14997 20.0956 7.14997 19.4998V10.1615C7.14997 9.56563 6.66247 9.07812 6.06664 9.07812Z"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M13.8666 5.62256H12.1333C11.5375 5.62256 11.05 6.11006 11.05 6.70589V19.5001C11.05 20.0959 11.5375 20.5834 12.1333 20.5834H13.8666C14.4625 20.5834 14.95 20.0959 14.95 19.5001V6.70589C14.95 6.11006 14.4625 5.62256 13.8666 5.62256Z"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M21.6666 2.1665H19.9333C19.3375 2.1665 18.85 2.654 18.85 3.24984V19.4998C18.85 20.0957 19.3375 20.5832 19.9333 20.5832H21.6666C22.2624 20.5832 22.7499 20.0957 22.7499 19.4998V3.24984C22.7499 2.654 22.2624 2.1665 21.6666 2.1665Z"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </router-link>
          </li>
          <li tabindex="4">
            <router-link to="/">
              <svg
                width="26"
                height="26"
                viewBox="0 0 26 26"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M2.16663 2.1665V20.5832C2.16663 22.3815 3.61829 23.8332 5.41663 23.8332H23.8333"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M5.41663 18.4168L10.3891 12.6102C11.2125 11.6568 12.675 11.5918 13.5633 12.491L14.5925 13.5202C15.4808 14.4085 16.9433 14.3543 17.7666 13.401L22.75 7.5835"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </router-link>
          </li>
          <li tabindex="5">
            <router-link to="/">
              <svg
                width="26"
                height="26"
                viewBox="0 0 26 26"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M13 16.25C14.7949 16.25 16.25 14.7949 16.25 13C16.25 11.2051 14.7949 9.75 13 9.75C11.2051 9.75 9.75 11.2051 9.75 13C9.75 14.7949 11.2051 16.25 13 16.25Z"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M2.16663 13.9532V12.0466C2.16663 10.9199 3.08746 9.98822 4.22496 9.98822C6.18579 9.98822 6.98746 8.60156 6.00163 6.90072C5.43829 5.92572 5.77413 4.65822 6.75996 4.09489L8.63413 3.02239C9.48996 2.51322 10.595 2.81656 11.1041 3.67239L11.2233 3.87822C12.1983 5.57906 13.8016 5.57906 14.7875 3.87822L14.9066 3.67239C15.4158 2.81656 16.5208 2.51322 17.3766 3.02239L19.2508 4.09489C20.2366 4.65822 20.5725 5.92572 20.0091 6.90072C19.0233 8.60156 19.825 9.98822 21.7858 9.98822C22.9125 9.98822 23.8441 10.9091 23.8441 12.0466V13.9532C23.8441 15.0799 22.9233 16.0116 21.7858 16.0116C19.825 16.0116 19.0233 17.3982 20.0091 19.0991C20.5725 20.0849 20.2366 21.3416 19.2508 21.9049L17.3766 22.9774C16.5208 23.4866 15.4158 23.1832 14.9066 22.3274L14.7875 22.1216C13.8125 20.4207 12.2091 20.4207 11.2233 22.1216L11.1041 22.3274C10.595 23.1832 9.48996 23.4866 8.63413 22.9774L6.75996 21.9049C5.77413 21.3416 5.43829 20.0741 6.00163 19.0991C6.98746 17.3982 6.18579 16.0116 4.22496 16.0116C3.08746 16.0116 2.16663 15.0799 2.16663 13.9532Z"
                  stroke="#63698B"
                  stroke-width="1.5"
                  stroke-miterlimit="10"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </router-link>
          </li>
        </ul>
      </nav>  
      <div class="col1">
        <header itemscope itemtype="https://schema.org/temperature">
          <img itemprop="logo" src="../assets/images/logo.svg" alt="logo"/>
          <h1 itemprop="name">Weather App</h1>
          <button role="button" tabindex="6">
            <div class="mr-3">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.5 21C16.7467 21 21 16.7467 21 11.5C21 6.25329 16.7467 2 11.5 2C6.25329 2 2 6.25329 2 11.5C2 16.7467 6.25329 21 11.5 21Z"
                  stroke="white"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M22 22L20 20"
                  stroke="white"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
            Search
          </button>
        </header>
        <section class="cols gap-8">
          <article class="today"
              v-for="(data, index) in computedHourly"
              :key="index">
            <div class=" flex mb-16">
              <div class="icon">
                <img itemprop="image" :src="`http://openweathermap.org/img/wn/${data.weather[0].icon}.png`" alt="icon temp">
              </div>
              <div class="ml-4">
                <time itemprop="day" datetime="P1D" class="day" > {{currentD()}} </time>
                <time itemprop="time" datetime="P1H" class="hour"> {{  currentH(index + 1)  }} </time>
              </div>
            </div>   
            <div class="cols mb-16">
              <div class="col6 flex">
                <div class="mr-5">
                  <h3 itemprop="QualitativeValue" class="mb-3"> {{Math.round(data.temp)}} ºC</h3>
                  <span> {{data.weather[0].description}} </span>
                </div>
                <div>
                  <small> {{Math.round(data.uvi)}} UVI </small>
                </div>
              </div>
              <div class="col6">
                <img class="h-48 w-48" :src="require(`../assets/images/${data.weather[0].icon}.svg`)" alt="{{data.weather[0].icon}}">
              </div>
            </div>
            <div class="card">
              <div class="bg-[#1B273C] bgd">
                <p>Pressure</p>
                <p> {{ data.pressure }} hPa </p>
              </div>
              <div class="bg-[#3c4314] bgd">
                <p>Visibility</p>
                <p> {{ (data.visibility) / 1000 }}  km</p>
              </div>
              <div class="bg-[#321746] bgd">
                <p>Humidity</p>
                <p> {{data.humidity}} %</p>
              </div>
            </div>
          </article>
        </section>
        <section class="cols h-96 mt-12">
          <article class="col-span-8">
            <h3>How's the temperature today?</h3>
            <section class="hours">
              <div
                class="imgs"
                v-for="(value, index) in computedNext"
                :key="index"
              >
                <img class="my-5" :src="require(`../assets/images/${value.weather[0].icon}.svg`)" alt="icon temp">
                <h2> {{Math.round(value.temp)}} ºC </h2>
                <p> {{ currentH(index + 3) }} </p>
              </div>
            </section>
          </article>
          <article class="image">
              <h2> {{currentTomorrow()}} </h2>
              <h3 aria-roledescription="{{ city }}"> {{city}} </h3>
              <p> {{ weather.main }} </p>
          </article>
        </section>
      </div>
    </main>

    <aside v-if="typeof current.weather != 'undefined'">
      <section class="principal">
        <div>
          <h3> {{ weather.main }} </h3>
          <time datetime="202-04-DD"> {{currentDateTime()}} </time>
          <span aria-roledescription="{{ city }}"> {{ city }} </span>
        </div>
        <img class="icon" :src="`http://openweathermap.org/img/wn/${weather.icon}.png`" alt="icon temp">
        <h2 class="text-[#6C5FF3]"> {{ Math.round(current.temp) }} ºC</h2> 
      </section>
      <section class=" mb-14">
        <h3> {{weather.description}} </h3>
        <div class="center">
          <img class="inline-block h-60 w-60" :src="require(`../assets/images/${weather.icon}.svg`)" alt="icon temp">
        </div>  
      </section>
      <section class="uvi">
        <div class="iuvi">
          <img :src="`http://openweathermap.org/img/wn/${weather.icon}.png`" alt="icon temp">
        </div>
        <div class="ml-7">
          <div class="uvif">
            <div v-if="3 > uvi">
              <p> {{uvi}} UVI </p>
              <p class="bg-[#2b792b] uvit">Low</p>
              <p>Low risk of from UV rays</p>
            </div>
            <div v-else-if=" 5 > uvi ">
              <p> {{uvi}} UVI</p>
              <p class="bg-[#c6c622] uvit">Moderate</p>
              <p>Moderate risk of from UV rays</p>
            </div> 
            <div v-else-if=" 8 > uvi ">
              <p> {{uvi}} UVI </p>
              <p class="bg-[#e98e2e] uvit">High</p>
              <p>High risk of from UV rays</p>
            </div> 
            <div v-else-if=" 11 > uvi ">
              <p> {{uvi}} UVI </p>
              <p class="bg-[#e92727] uvit">Very High</p>
              <p>Very high risk of from UV rays</p>
            </div> 
            <div v-else >
              <p> {{uvi}} UVI </p>
              <p class="bg-[#481262] uvit">Extreme</p>
              <p>Extreme risk of from UV rays</p>
            </div> 
          </div>
        </div>
      </section>
      <section>
        <div class="mt-16 mb-8">
          <p class="text-2xl">Weather Prediction</p>
        </div>
        <div
          class="daily"
          v-for="(value, index) in computedDaily"
          :key="index"
        >
          <div class="icon">
            <img :src="`http://openweathermap.org/img/wn/${value.weather[0].icon}.png`" alt="temperature">
          </div>
          <div>
            <p class="text-xl"> {{Math.round(value.temp.day)}} ºC </p>
            <p class="hour"> {{  currentDay(index + 1)  }} </p>
          </div>
          <div>
            <p class="temp"> {{Math.round(value.temp.min)}} ºC / {{Math.round(value.temp.max)}} ºC</p>
          </div>
        </div>
        <div>
          <button role="button" tabindex="7" @click=" showMore ">
            <p v-if="show === true"> See More </p>
            <p v-else > Show Less </p>
          </button>
        </div>
      </section>
    </aside>
  </div>
</template>

<script>
// @ is an alias to /src
import moment from 'moment';

export default {
  name: "HomeView",
  components: {
  },

  mounted() {
    this.fetchWeather(this.lat, this.lon),
    this.fetchCity(this.lat, this.lon)
  },


  data() {
    return {
      api_key: "b800e16deb21629cb7c3342c5ea03fa6",
      url_base: "https://api.openweathermap.org/data/2.5/",
      lat: "-12.0405887",
      lon: "-76.9229779",
      current: {},
      uvi: '',
      hourly: [],
      daily: [],
      weather: [],
      city: "Lima",
      limit: 3,
      amount: 3,
      stages:7,
      show: true
    };
  },


  methods: {
    fetchWeather(lat, lon) {    
        fetch(
          `${this.url_base}onecall?lat=${lat}&lon=${lon}&units=metric&appid=${this.api_key}`
        )
          .then((res) => {
            return res.json();
          })
          .then(this.setResults);
    
    },
    fetchCity(lat, lon){
      fetch(
        `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=es`
      )
        .then((res) => {
            return res.json();
          })
          .then(this.setCity);
    },
    setCity(results) {
      this.city = results.locality
      console.log(this.city)
    },
    setResults(results) {
      this.current = results.current;
      this.weather = results.current.weather[0];
      this.daily = results.daily;
      this.hourly = results.hourly;
      this.uvi = Math.round(results.current.uvi)
      console.log(this.daily)
    },
    currentDateTime() {
      return moment().format('LL')
    },
    currentDay( value ) {
      return moment().add( value, "days").format('dddd')
    },
    currentTomorrow(){
      return moment().add(1,'d').format('dddd')
    }, 
    currentD() {
      return moment().format('dddd')
    },
    currentHour() {
      return moment().format('LT');
    },
    currentH( value ) {
      return moment().add( value, "h").format('LT')
    },
    showMore() {
      this.show = !this.show
      return this.show ? this.limit = 3 : this.limit = null
    },
  },


  computed:{
  computedDaily(){
    return this.limit ? this.daily.slice( 1,this.limit ) : this.daily
  },
  computedDay() {
    return this.daily.slice(0,1);
  },
  computedHourly(){
    return this.amount ? this.hourly.slice( 1,this.amount ) : this.hourly
  },
  computedNext() {
    return this.stages ? this.hourly.slice( 3,this.stages ) : this.hourly
  }
}
};
</script>

<style>
</style>